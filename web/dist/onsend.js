!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=784)}({106:function(e,t,n){(function(t,n){
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */var r;r=function(){"use strict";function e(e){return"function"==typeof e}var r=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},o=0,s=void 0,i=void 0,a=function(e,t){d[o]=e,d[o+1]=t,2===(o+=2)&&(i?i(g):S())},c="undefined"!=typeof window?window:void 0,l=c||{},u=l.MutationObserver||l.WebKitMutationObserver,f="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),m="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function p(){var e=setTimeout;return function(){return e(g,1)}}var d=new Array(1e3);function g(){for(var e=0;e<o;e+=2)(0,d[e])(d[e+1]),d[e]=void 0,d[e+1]=void 0;o=0}var h,y,v,w,S=void 0;function b(e,t){var n=this,r=new this.constructor(I);void 0===r[_]&&N(r);var o=n._state;if(o){var s=arguments[o-1];a((function(){return F(o,r,s,n._result)}))}else E(n,r,e,t);return r}function x(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(I);return A(t,e),t}f?S=function(){return t.nextTick(g)}:u?(y=0,v=new u(g),w=document.createTextNode(""),v.observe(w,{characterData:!0}),S=function(){w.data=y=++y%2}):m?((h=new MessageChannel).port1.onmessage=g,S=function(){return h.port2.postMessage(0)}):S=void 0===c?function(){try{var e=Function("return this")().require("vertx");return void 0!==(s=e.runOnLoop||e.runOnContext)?function(){s(g)}:p()}catch(e){return p()}}():p();var _=Math.random().toString(36).substring(2);function I(){}function T(t,n,r){n.constructor===t.constructor&&r===b&&n.constructor.resolve===x?function(e,t){1===t._state?R(e,t._result):2===t._state?D(e,t._result):E(t,void 0,(function(t){return A(e,t)}),(function(t){return D(e,t)}))}(t,n):void 0===r?R(t,n):e(r)?function(e,t,n){a((function(e){var r=!1,o=function(e,t,n,r){try{e.call(t,n,r)}catch(e){return e}}(n,t,(function(n){r||(r=!0,t!==n?A(e,n):R(e,n))}),(function(t){r||(r=!0,D(e,t))}),e._label);!r&&o&&(r=!0,D(e,o))}),e)}(t,n,r):R(t,n)}function A(e,t){if(e===t)D(e,new TypeError("You cannot resolve a promise with itself"));else if(o=typeof(r=t),null===r||"object"!==o&&"function"!==o)R(e,t);else{var n=void 0;try{n=t.then}catch(t){return void D(e,t)}T(e,t,n)}var r,o}function O(e){e._onerror&&e._onerror(e._result),M(e)}function R(e,t){void 0===e._state&&(e._result=t,e._state=1,0!==e._subscribers.length&&a(M,e))}function D(e,t){void 0===e._state&&(e._state=2,e._result=t,a(O,e))}function E(e,t,n,r){var o=e._subscribers,s=o.length;e._onerror=null,o[s]=t,o[s+1]=n,o[s+2]=r,0===s&&e._state&&a(M,e)}function M(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r=void 0,o=void 0,s=e._result,i=0;i<t.length;i+=3)r=t[i],o=t[i+n],r?F(n,r,o,s):o(s);e._subscribers.length=0}}function F(t,n,r,o){var s=e(r),i=void 0,a=void 0,c=!0;if(s){try{i=r(o)}catch(e){c=!1,a=e}if(n===i)return void D(n,new TypeError("A promises callback cannot return that same promise."))}else i=o;void 0!==n._state||(s&&c?A(n,i):!1===c?D(n,a):1===t?R(n,i):2===t&&D(n,i))}var P=0;function N(e){e[_]=P++,e._state=void 0,e._result=void 0,e._subscribers=[]}var B=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(I),this.promise[_]||N(this.promise),r(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?R(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&R(this.promise,this._result))):D(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;void 0===this._state&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===x){var o=void 0,s=void 0,i=!1;try{o=e.then}catch(e){i=!0,s=e}if(o===b&&void 0!==e._state)this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=e;else if(n===C){var a=new n(I);i?D(a,s):T(a,e,o),this._willSettleAt(a,t)}else this._willSettleAt(new n((function(t){return t(e)})),t)}else this._willSettleAt(r(e),t)},e.prototype._settledAt=function(e,t,n){var r=this.promise;void 0===r._state&&(this._remaining--,2===e?D(r,n):this._result[t]=n),0===this._remaining&&R(r,this._result)},e.prototype._willSettleAt=function(e,t){var n=this;E(e,void 0,(function(e){return n._settledAt(1,t,e)}),(function(e){return n._settledAt(2,t,e)}))},e}(),C=function(){function t(e){this[_]=P++,this._result=this._state=void 0,this._subscribers=[],I!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(e,t){try{t((function(t){A(e,t)}),(function(t){D(e,t)}))}catch(t){D(e,t)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(e){return this.then(null,e)},t.prototype.finally=function(t){var n=this.constructor;return e(t)?this.then((function(e){return n.resolve(t()).then((function(){return e}))}),(function(e){return n.resolve(t()).then((function(){throw e}))})):this.then(t,t)},t}();return C.prototype.then=b,C.all=function(e){return new B(this,e).promise},C.race=function(e){var t=this;return r(e)?new t((function(n,r){for(var o=e.length,s=0;s<o;s++)t.resolve(e[s]).then(n,r)})):new t((function(e,t){return t(new TypeError("You must pass an array to race."))}))},C.resolve=x,C.reject=function(e){var t=new this(I);return D(t,e),t},C._setScheduler=function(e){i=e},C._setAsap=function(e){a=e},C._asap=a,C.polyfill=function(){var e=void 0;if(void 0!==n)e=n;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var r=null;try{r=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===r&&!t.cast)return}e.Promise=C},C.Promise=C,C},e.exports=r()}).call(this,n(190),n(90))},190:function(e,t){var n,r,o=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function a(e){if(n===setTimeout)return setTimeout(e,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:s}catch(e){n=s}try{r="function"==typeof clearTimeout?clearTimeout:i}catch(e){r=i}}();var c,l=[],u=!1,f=-1;function m(){u&&c&&(u=!1,c.length?l=c.concat(l):f=-1,l.length&&p())}function p(){if(!u){var e=a(m);u=!0;for(var t=l.length;t;){for(c=l,l=[];++f<t;)c&&c[f].run();f=-1,t=l.length}c=null,u=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===i||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function d(e,t){this.fun=e,this.array=t}function g(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new d(e,t)),1!==l.length||u||a(p)},d.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=g,o.addListener=g,o.once=g,o.off=g,o.removeListener=g,o.removeAllListeners=g,o.emit=g,o.prependListener=g,o.prependOnceListener=g,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},257:function(e,t,n){"use strict";(function(e,n){var r,o=this&&this.__awaiter||function(t,n,r,o){return new(r||(r=e))((function(e,s){function i(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(i,a)}c((o=o.apply(t,n||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};function i(t,n,r){console.log("[START] promiseReplaceNotificationMessage");var o={message:r.substr(0,120),type:n};return n==Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage&&(o.icon="Icon.80x80",o.persistent=!0),console.log("[END] promiseReplaceNotificationMessage"),new e((function(e,n){Office.context.mailbox.item.notificationMessages.replaceAsync(t,o,null,(function(t){console.log("[promiseReplaceNotificationMessage] 完了しました。status : "+t.status),t.status==Office.AsyncResultStatus.Failed?n(t.error):e()}))}))}function a(t){var n='<?xml version="1.0" encoding="utf-8"?>\n  <soap:Envelope xmlns:xsi="https://www.w3.org/2001/XMLSchema-instance"\n                 xmlns:xsd="https://www.w3.org/2001/XMLSchema"\n                 xmlns:m="http://schemas.microsoft.com/exchange/services/2006/messages" \n                 xmlns:t="http://schemas.microsoft.com/exchange/services/2006/types" \n                 xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">\n    <soap:Header>\n      <t:RequestServerVersion Version="Exchange2013" soap:mustUnderstand="0" />\n    </soap:Header>\n    <soap:Body>\n      <m:GetItem>\n        <m:ItemShape>\n          <t:BaseShape>IdOnly</t:BaseShape>\n          <t:AdditionalProperties>\n            <t:FieldURI FieldURI="item:TextBody" />\n          </t:AdditionalProperties>\n        </m:ItemShape>\n        <m:ItemIds>\n          <t:ItemId Id="'+t+'" />\n        </m:ItemIds>\n      </m:GetItem>\n    </soap:Body>\n  </soap:Envelope>';return new e((function(e,t){console.log("[promiseGetTextBody] START/END"),Office.context.mailbox.makeEwsRequestAsync(n,(function(n){if(n.status==Office.AsyncResultStatus.Failed)t(n.error);else try{var r=(new DOMParser).parseFromString(n.value,"text/xml").getElementsByTagNameNS("http://schemas.microsoft.com/exchange/services/2006/types","TextBody")[0];e(r.innerHTML)}catch(e){console.error(e),t(e)}}))}))}function c(n,i,c){var l=this;return console.log("[START/END] promiseGetProperty"),new e((function(e,f){return o(l,void 0,void 0,(function(){var o,l,m,p;return s(this,(function(s){switch(s.label){case 0:if(c!=r.Body)return[3,8];s.label=1;case 1:return s.trys.push([1,6,,7]),n?(l=a,[4,u()]):[3,4];case 2:return[4,l.apply(void 0,[s.sent()])];case 3:return o=s.sent(),e(o.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'")),[3,5];case 4:Office.context.mailbox.item.body.getAsync(Office.CoercionType.Text,null,(function(t){console.log("[promiseGetProperty] 完了しました。(Html) status : "+t.status),t.status==Office.AsyncResultStatus.Failed?f(t.error):e(t.value)})),s.label=5;case 5:return[3,7];case 6:return m=s.sent(),f(m),[3,7];case 7:return[3,9];case 8:p=null,c==r.From?p=Office.context.mailbox.item.from:c==r.To?p=Office.context.mailbox.item.to:c==r.Cc?p=Office.context.mailbox.item.cc:c==r.Bcc?p=Office.context.mailbox.item.bcc:c==r.Subject&&(p=Office.context.mailbox.item.subject),p.getAsync(null,(function(n){if(console.log("[promiseGetProperty] 完了しました。status : "+n.status),n.status==Office.AsyncResultStatus.Failed)f(n.error);else if(c==r.To||c==r.Cc||c==r.Bcc){for(var o=[],s=0,a=n.value;s<a.length;s++){var l=a[s];o.push({name:l.displayName,isPrivateDL:!l.emailAddress,type:c,emailAddress:l.emailAddress||"",routingType:"",mailboxType:"",itemId:"",isExternal:l.emailAddress&&i!==t.getDomainFromEmailAddress(l.emailAddress)})}e(o)}else(c==r.Subject||c==r.From)&&e(n.value)})),s.label=9;case 9:return[2]}}))}))}))}function l(e){return o(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,i(t.NotificationKeyInfo,Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,"誤送信防止アドイン : "+e)];case 1:return n.sent(),[2]}}))}))}Object.defineProperty(t,"__esModule",{value:!0}),t.setRoamingSettingFromLocalStorage=t.setLocalStorageFromRoamingSetting=t.promiseSaveRoamingSetting=t.promiseSetDefferedDeliveryTime=t.extractCustomMessageItemInfo=t.promiseGetItemId=t.promiseSaveAsDraft=t.getDomainFromEmailAddress=t.promiseOpenDialog=t.promiseDisplayErrorMessage=t.promiseDisplayMessage=t.promiseGetItem=t.getGlobal=t.MailPropertyType=t.DialogMessageCancel=t.BasicFontSizePt=t.FontSizeChoice=t.SettingKeyAccessibilitySize=t.SettingKeyDelaySendKey=t.MaximumRecipients=t.DialogTimeout=t.DialogTimeoutWarning=t.NotificationKeyError=t.NotificationKeyInfo=void 0,t.NotificationKeyInfo="OnFcsMailAddin",t.NotificationKeyError="OnFcsMailAddinError",t.DialogTimeoutWarning=269e3,t.DialogTimeout=299e3,t.MaximumRecipients=100,t.SettingKeyDelaySendKey="mail_delay_send_key",t.SettingKeyAccessibilitySize="accessibility_size",t.FontSizeChoice=["small","medium","large"],t.BasicFontSizePt=[12,14,16],t.DialogMessageCancel="<NO>",function(e){e[e.None=0]="None",e[e.From=1]="From",e[e.To=2]="To",e[e.Cc=3]="Cc",e[e.Bcc=4]="Bcc",e[e.Subject=5]="Subject",e[e.Body=6]="Body"}(r=t.MailPropertyType||(t.MailPropertyType={})),t.getGlobal=function(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n?n:void 0},t.promiseGetItem=function(t){var n=this,r='<?xml version="1.0" encoding="utf-8"?>\n  <soap:Envelope xmlns:xsi="https://www.w3.org/2001/XMLSchema-instance"\n                 xmlns:xsd="https://www.w3.org/2001/XMLSchema"\n                 xmlns:m="http://schemas.microsoft.com/exchange/services/2006/messages" \n                 xmlns:t="http://schemas.microsoft.com/exchange/services/2006/types" \n                 xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">\n    <soap:Header>\n      <t:RequestServerVersion Version="Exchange2013" soap:mustUnderstand="0" />\n    </soap:Header>\n    <soap:Body>\n      <m:GetItem>\n        <m:ItemShape>\n          <t:BaseShape>AllProperties</t:BaseShape>\n          <t:AdditionalProperties>\n            <t:ExtendedFieldURI PropertyTag="16367" PropertyType="SystemTime" />\n          </t:AdditionalProperties>\n        </m:ItemShape>\n        <m:ItemIds>\n          <t:ItemId Id="'+t+'" />\n        </m:ItemIds>\n      </m:GetItem>\n    </soap:Body>\n  </soap:Envelope>';return new e((function(e,t){Office.context.mailbox.makeEwsRequestAsync(r,(function(r){return o(n,void 0,void 0,(function(){return s(this,(function(n){return r.status==Office.AsyncResultStatus.Failed?t(r.error):e(r.value),[2]}))}))}))}))},t.promiseDisplayMessage=l,t.promiseDisplayErrorMessage=function(e){return o(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,i(t.NotificationKeyError,Office.MailboxEnums.ItemNotificationMessageType.ErrorMessage,"誤送信防止アドイン : "+e)];case 1:return n.sent(),[2]}}))}))},t.promiseOpenDialog=function(n){return o(this,void 0,void 0,(function(){var i,a,u,m,p,d,g,h,y,v,w,S;return s(this,(function(b){switch(b.label){case 0:return[4,c(n,null,r.Subject)];case 1:return i=b.sent(),[4,c(n,null,r.Body)];case 2:return a=b.sent(),u=t.getDomainFromEmailAddress(Office.context.mailbox.userProfile.emailAddress),[4,c(n,u,r.To)];case 3:return m=b.sent(),[4,c(n,u,r.Cc)];case 4:return p=b.sent(),[4,c(n,u,r.Bcc)];case 5:return d=b.sent(),g=m.concat(p).concat(d),window.localStorage.setItem("mail_subject",i),window.localStorage.setItem("mail_body",a),y=(h=window.localStorage).setItem,v=["mail_attachments"],S=(w=JSON).stringify,[4,(console.log("[START/END] promiseGetAttachments"),new e((function(e,t){Office.context.mailbox.item.getAttachmentsAsync(null,(function(n){console.log("[promiseGetAttachments] 完了しました。status : "+n.status),n.status==Office.AsyncResultStatus.Failed?t(n.error):e(n.value)}))})))];case 6:return y.apply(h,v.concat([S.apply(w,[b.sent()])])),window.localStorage.setItem("mail_recipients",JSON.stringify(g)),setTimeout((function(){return o(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,f(g)];case 1:return e.sent().length>0?window.localStorage.setItem("mail_recipient_pattern_exists","yes"):window.localStorage.setItem("mail_recipient_pattern_exists","no"),[2]}}))}))})),console.log("[START/END] promiseOpenDialog"),[2,new e((function(e,t){Office.context.ui.displayDialogAsync(window.location.origin+"/dialog.html",{height:70,width:70,displayInIframe:!0},(function(n){if(n.status==Office.AsyncResultStatus.Failed)console.error("[promiseOpenDialog] ダイアログを開けませんでした。asRes.error.code : "+n.error.code),t(n.error);else{var r=n.value;r.addEventHandler(Office.EventType.DialogMessageReceived,(function(n){return o(this,void 0,void 0,(function(){var o;return s(this,(function(s){switch(s.label){case 0:console.log("[promiseOpenDialog] メッセージを受信しました。arg.message : "+n.message),s.label=1;case 1:return s.trys.push([1,4,,5]),n.message.indexOf("<ENCRYPT>")>=0?[4,l("処理が完了しました。")]:[3,3];case 2:s.sent(),s.label=3;case 3:return r.close(),n.message.indexOf("<YES>")>=0?e(!0):e(!1),[3,5];case 4:return o=s.sent(),console.error(o),t(o),[3,5];case 5:return[2]}}))}))})),r.addEventHandler(Office.EventType.DialogEventReceived,(function(n){console.log("[promiseOpenDialog] イベントを受信しました。arg.error : "+n.error);var r="";switch(n.error){case 12002:r="Cannot load URL, no such page or bad URL syntax.";break;case 12003:r="HTTPS is required.";break;case 12006:e(!1);break;default:r="Unknown error."}t({code:n.error,message:r,name:"DialogEventReceived"})}))}}))}))]}}))}))};function u(){return console.log("[START/END] promiseGetItemId"),new e((function(e,t){Office.context.mailbox.item.getItemIdAsync(null,(function(n){console.log("[promiseGetItemId] 完了しました。status : "+n.status),n.status==Office.AsyncResultStatus.Failed?t(n.error):e(n.value)}))}))}function f(t){var n='<?xml version="1.0" encoding="utf-8"?>\n  <soap:Envelope xmlns:xsi="https://www.w3.org/2001/XMLSchema-instance" \n               xmlns:xsd="https://www.w3.org/2001/XMLSchema" \n               xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" \n               xmlns:t="http://schemas.microsoft.com/exchange/services/2006/types"\n               xmlns:m="http://schemas.microsoft.com/exchange/services/2006/messages">\n    <soap:Header>\n      <t:RequestServerVersion Version="Exchange2013" />\n    </soap:Header>\n    <soap:Body>\n      <m:FindItem Traversal="Shallow">\n        <m:ItemShape>\n          <t:BaseShape>IdOnly</t:BaseShape>\n          <t:AdditionalProperties>\n            <t:FieldURI FieldURI="message:ToRecipients" />\n            <t:FieldURI FieldURI="message:CcRecipients" />\n            <t:FieldURI FieldURI="message:BccRecipients" />\n          </t:AdditionalProperties>\n        </m:ItemShape>\n        <m:IndexedPageItemView MaxEntriesReturned="1" Offset="0" BasePoint="Beginning" />\n        <m:ParentFolderIds>\n          <t:DistinguishedFolderId Id="sentitems"/>\n        </m:ParentFolderIds>\n        <m:QueryString>'+function(e){for(var t=[],n=0,o=e;n<o.length;n++){var s=o[n],i=s.emailAddress,a="";switch(s.type){case r.To:a="to";break;case r.Cc:a="cc";break;case r.Bcc:a="bcc"}i&&i.indexOf("@")>=0&&t.push(a+":"+i)}return t.join(" AND ")}(t)+"</m:QueryString>\n      </m:FindItem>\n    </soap:Body>\n  </soap:Envelope>";return new e((function(e,t){Office.context.mailbox.makeEwsRequestAsync(n,(function(n){if(console.log("[promiseGetSentItems] 完了しました。status : "+n.status),n.status==Office.AsyncResultStatus.Failed)t(n.error);else{var r=(new DOMParser).parseFromString(n.value,"text/xml"),o=[];if("Success"===r.getElementsByTagNameNS("http://schemas.microsoft.com/exchange/services/2006/messages","FindItemResponseMessage")[0].getAttribute("ResponseClass"))for(var s=r.getElementsByTagNameNS("http://schemas.microsoft.com/exchange/services/2006/types","ItemId"),i=0;i<s.length;++i){var a=s[i].getAttribute("Id");o.push(a)}e(o)}}))}))}t.getDomainFromEmailAddress=function(e){return e.substr(1+e.lastIndexOf("@"))},t.promiseSaveAsDraft=function(){return console.log("[START/END] promiseSaveAsDraft"),new e((function(e,t){Office.context.mailbox.item.saveAsync(null,(function(n){console.log("[promiseSaveAsDraft] 完了しました。status : "+n.status),n.status==Office.AsyncResultStatus.Failed?t(n.error):e(n.value)}))}))},t.promiseGetItemId=u,t.extractCustomMessageItemInfo=function(e){var t=(new DOMParser).parseFromString(e,"text/xml"),n=t.getElementsByTagNameNS("http://schemas.microsoft.com/exchange/services/2006/types","ItemId")[0],r=n.getAttribute("Id"),o=n.getAttribute("ChangeKey"),s=t.getElementsByTagNameNS("http://schemas.microsoft.com/exchange/services/2006/types","InternetMessageId"),i="";return s.length>0&&(i=(i=s[0].innerHTML).substring(4,i.length-4)),{id:r,changeKey:o,debug:e,internetMessageId:i}},t.promiseSetDefferedDeliveryTime=function(t,n,r){var o=function(e){console.log("[START] getDateStringISO8601");var t=("0000"+e.getFullYear()).slice(-4)+"-"+("00"+(e.getMonth()+1)).slice(-2)+"-"+("00"+e.getDate()).slice(-2)+"T"+("00"+e.getHours()).slice(-2)+":"+("00"+e.getMinutes()).slice(-2)+":"+("00"+e.getSeconds()).slice(-2);return console.log("[END] getDateStringISO8601"),t}(new Date((new Date).getTime()+6e4*n-324e5)),s='<?xml version="1.0" encoding="utf-8"?>\n  <soap:Envelope xmlns:xsi="https://www.w3.org/2001/XMLSchema-instance" \n               xmlns:xsd="https://www.w3.org/2001/XMLSchema" \n               xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" \n               xmlns:t="http://schemas.microsoft.com/exchange/services/2006/types">\n    <soap:Header>\n      <t:RequestServerVersion Version="Exchange2013" soap:mustUnderstand="0" />\n    </soap:Header>\n    <soap:Body>\n      <UpdateItem MessageDisposition="'+(r?"SaveOnly":"SendOnly")+'" ConflictResolution="AutoResolve" \n                  xmlns="http://schemas.microsoft.com/exchange/services/2006/messages">\n        <ItemChanges>\n          <t:ItemChange>\n            <t:ItemId Id="'+t.id+'" ChangeKey="'+t.changeKey+'" />\n            <t:Updates>\n              <t:SetItemField>\n                <t:ExtendedFieldURI PropertyTag="16367" PropertyType="SystemTime" />\n                <t:Message>\n                  <t:ExtendedProperty>\n                    <t:ExtendedFieldURI PropertyTag="16367"\n                                        PropertyType="SystemTime" />\n                    <t:Value>'+o+"</t:Value>\n                  </t:ExtendedProperty>\n                </t:Message>\n              </t:SetItemField>\n            </t:Updates>\n          </t:ItemChange>\n        </ItemChanges>\n      </UpdateItem>\n    </soap:Body>\n  </soap:Envelope>";return console.log("[START/END] promiseSetDefferedDeliveryTime"),new e((function(e,t){Office.context.mailbox.makeEwsRequestAsync(s,(function(n){if(console.log("[promiseSetDefferedDeliveryTime] 完了しました。status : "+n.status),n.status==Office.AsyncResultStatus.Failed)t(n.error);else try{if("Success"!==(new DOMParser).parseFromString(n.value,"text/xml").getElementsByTagNameNS("http://schemas.microsoft.com/exchange/services/2006/messages","UpdateItemResponseMessage")[0].getAttribute("ResponseClass"))throw new Error("promiseSetDefferedDeliveryTime failed.");e(!0)}catch(e){e.message="[promiseSetDefferedDeliveryTime] "+e.message,t(e)}}))}))},t.promiseSaveRoamingSetting=function(){return console.log("[START/END] promiseSaveRoamingSetting"),new e((function(e,t){Office.context.roamingSettings.saveAsync((function(n){n.status!==Office.AsyncResultStatus.Succeeded?t(n.error):(console.log("[promiseSaveRoamingSetting] 完了しました。status : "+n.status),e())}))}))},t.setLocalStorageFromRoamingSetting=function(e,t){var n=Office.context.roamingSettings.get(e)||t;window.localStorage.setItem(e,n)},t.setRoamingSettingFromLocalStorage=function(e){Office.context.roamingSettings.set(e,window.localStorage.getItem(e))},function(){var e="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0;if(e){var n="undefined"!=typeof __webpack_exports__?__webpack_exports__:t;if(n)if("function"!=typeof n){for(var r in n)if(Object.prototype.hasOwnProperty.call(n,r)){var o=void 0;try{o=n[r]}catch(e){continue}e.register(o,r,"C:\\Users\\youhei_mori\\Desktop\\res_2020\\mail_addin\\web\\src\\common.ts")}}else e.register(n,"module.exports","C:\\Users\\youhei_mori\\Desktop\\res_2020\\mail_addin\\web\\src\\common.ts")}}()}).call(this,n(106).Promise,n(90))},784:function(e,t,n){"use strict";(function(e){var r=this&&this.__awaiter||function(t,n,r,o){return new(r||(r=e))((function(e,s){function i(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(i,a)}c((o=o.apply(t,n||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(257);function i(e){return r(this,void 0,void 0,(function(){var t,n,r,i,a,c,l,u,f,m;return o(this,(function(o){switch(o.label){case 0:t=Office.context.platform==Office.PlatformType.OfficeOnline,n=!1,r=!1,o.label=1;case 1:return o.trys.push([1,14,22,23]),"message"!==Office.context.mailbox.item.itemType?[3,12]:(window.localStorage.clear(),window.localStorage.setItem("time_activated",(new Date).toISOString()),[4,s.promiseSaveAsDraft()]);case 2:return o.sent(),[4,s.promiseDisplayMessage("メッセージを下書き保存しました。")];case 3:return o.sent(),[4,s.promiseDisplayMessage("アイテムから情報を取得しました。")];case 4:return o.sent(),s.setLocalStorageFromRoamingSetting(s.SettingKeyDelaySendKey,"delay_send_0"),s.setLocalStorageFromRoamingSetting("width_recipient_name","120"),s.setLocalStorageFromRoamingSetting("width_recipient_address","220"),s.setLocalStorageFromRoamingSetting("width_attachment_name","120"),s.setLocalStorageFromRoamingSetting("width_attachment_size","70"),s.setLocalStorageFromRoamingSetting(s.SettingKeyAccessibilitySize,s.FontSizeChoice[1]),[4,s.promiseOpenDialog(t)];case 5:if(!o.sent())throw r=!0,new Error("キャンセルしました。");if("timeout"===window.localStorage.getItem("timeout"))throw new Error("処理がタイムアウトしました。");return t?(i=window.localStorage.getItem(s.SettingKeyDelaySendKey),Office.context.roamingSettings.set(s.SettingKeyDelaySendKey,i),(a=Math.floor(parseFloat(i.substring(i.lastIndexOf("_")+1))))>0&&a<30?[4,s.promiseGetItemId()]:[3,9]):[3,10];case 6:return c=o.sent(),[4,s.promiseGetItem(c)];case 7:return l=o.sent(),u=s.extractCustomMessageItemInfo(l),[4,s.promiseSetDefferedDeliveryTime(u,a,t)];case 8:return o.sent(),[3,10];case 9:if(a>=30)throw new Error("遅延送信情報が不正です。");o.label=10;case 10:return s.setRoamingSettingFromLocalStorage("width_recipient_name"),s.setRoamingSettingFromLocalStorage("width_recipient_address"),s.setRoamingSettingFromLocalStorage("width_attachment_name"),s.setRoamingSettingFromLocalStorage("width_attachment_size"),[4,s.promiseSaveRoamingSetting()];case 11:return o.sent(),n=!0,[3,13];case 12:n=!0,o.label=13;case 13:return[3,23];case 14:f=o.sent(),o.label=15;case 15:return o.trys.push([15,20,,21]),console.error(f),r?[3,17]:[4,s.promiseDisplayMessage("アドインの処理エラーにより送信が中止されました。詳細："+f.message)];case 16:return o.sent(),[3,19];case 17:return[4,s.promiseDisplayMessage("確認ダイアログにより送信はキャンセルされました。")];case 18:o.sent(),o.label=19;case 19:return[3,21];case 20:return m=o.sent(),console.error(m),[3,21];case 21:return[3,23];case 22:try{window.localStorage.clear()}catch(e){console.error(e)}return e.completed({allowEvent:n}),[7];case 23:return[2]}}))}))}Office.onReady((function(){s.getGlobal().inspect=i})),function(){var e="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0;if(e){var n="undefined"!=typeof __webpack_exports__?__webpack_exports__:t;if(n)if("function"!=typeof n){for(var r in n)if(Object.prototype.hasOwnProperty.call(n,r)){var o=void 0;try{o=n[r]}catch(e){continue}e.register(o,r,"C:\\Users\\youhei_mori\\Desktop\\res_2020\\mail_addin\\web\\src\\onsend\\onsend.ts")}}else e.register(n,"module.exports","C:\\Users\\youhei_mori\\Desktop\\res_2020\\mail_addin\\web\\src\\onsend\\onsend.ts")}}()}).call(this,n(106).Promise)},90:function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n}});
//# sourceMappingURL=onsend.js.map